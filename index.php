<?phpini_set('display_errors', '1');require('system.php');require('procfs.php');if (isset($_REQUEST['async'])) {	$data = array();		// memory	$data['memory'] = array();	$meminfo = proc_meminfo();	$data['memory']['total'] = system_byteval($meminfo['MemTotal']);	$data['memory']['free'] = system_byteval($meminfo['MemFree']);	$data['memory']['active'] = $data['memory']['total'] - $data['memory']['free'];	// disks	$diskstats = proc_diskstats();	$data['disks'] = array();	foreach ($diskstats as $disk) {		if (intval($disk[0]) == 8) {			$diskstat = array();			$diskstat['name'] = $disk[2];			$diskstat['read'] = intval($disk[5])*512;			$diskstat['write'] = intval($disk[9])*512;			array_push($data['disks'], $diskstat);		}	}		echo json_encode($data);	exit();}?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><script type="text/javascript" src="http://libs.baidu.com/jquery/1.9.0/jquery.js"></script><style>body {	margin:0px;	padding:0px;	font-family:Verdana, Geneva, 'Microsoft Yahei', 'Segoe UI Symbol', sans-serif;	font-size:12px;	line-height:16px;}table {	border: 1px solid #999999;	border-collapse: collapse;	border-spacing: 0px;}td,th {	border: 1px solid #999999;	padding: 3px 6px;	text-aligin:center;}th {	text-align: left;}#system {	margin:32px auto;	width:512px;	padding-bottom: 8px;	border: 1px solid #d5d5d5;	border-radius: 4px;	padding: 12px 16px;}.system_title {	font-size:14px;	line-height:20px;	padding: 12px 0px 6px;}</style></head><body><script type="text/javascript">var cache = [];function fetch() {	$.ajax({		url: './?async',		dataType: "json",		success: function(data) {			$('#memory_total').html(unit(data['memory']['total']));			$('#memory_free').html(unit(data['memory']['free']));			$('#memory_active').html(unit(data['memory']['active']));						for(i=0; i<data['disks'].length; i++) {				disk = data['disks'][i];				if( $('#disk_'+disk['name']).length == 0)				{					create_disk(disk.name);					cache['disk_writespeed_'+disk.name] = 0;					cache['disk_readspeed_'+disk.name] = 0;					cache['disk_write_'+disk.name] = disk['write'];					cache['disk_read_'+disk.name] = disk['read'];				}								disk_write = disk['write'] - cache['disk_write_'+disk.name];				cache['disk_write_'+disk.name] = disk['write'];				disk_read = disk['read'] - cache['disk_read_'+disk.name];				cache['disk_read_'+disk.name] = disk['read'];								disk_write = disk_write * 0.2 + cache['disk_writespeed_'+disk.name]* 0.8;				disk_read = disk_read * 0.2 + cache['disk_readspeed_'+disk.name]* 0.8;				cache['disk_writespeed_'+disk.name] = disk_write;				cache['disk_readspeed_'+disk.name] = disk_read								$('#disk_read_'+disk['name']).html(unit(disk_read) + '/s');				$('#disk_write_'+disk['name']).html(unit(disk_write) + '/s');			}					}	});	setTimeout(fetch, 1000);}$(document).ready(function() {	setTimeout(fetch, 1000);});function create_disk(name) {	tr = $('<tr/>', {'id':'disk_'+name});	$('<td>').html(name).appendTo(tr);	$('<td>').attr('id','disk_read_'+name).html(0).appendTo(tr);	$('<td>').attr('id','disk_write_'+name).html(0).appendTo(tr); 	tr.appendTo('#system_disks'); }function unit (size) {	if (size < 1024 ) return size.toFixed(2) + ' B';	size = size/1024;	if (size < 1024 ) return size.toFixed(2) + ' KB';	size = size/1024;	if (size < 1024 ) return size.toFixed(2) + ' MB';	size = size/1024;	if (size < 1024 ) return size.toFixed(2) + ' GB';}</script><div id="system"><div class="system_title">内存信息</div><table><tr><th width="96">所有</th><th width="96">占用</th><th width="96">空闲</th></tr><tr><td><span id="memory_total">0</span></td><td><span id="memory_active">0</span></td><td><span id="memory_free">0</span></td></tr></table><div class="system_title">硬盘信息</div><table id="system_disks"><tr><th width="96">设备</th><th width="96">读取</th><th width="96">写入</th></tr></table></div></body></html>